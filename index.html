<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>T·∫øt Trung Thu ‚ú®üåï</title>
  <meta name="description" content="Thi·ªáp web Trung Thu c√≥ nh·∫°c, hi·ªáu ·ª©ng ph√°o hoa v√† l·ªùi ch√∫c √Ω nghƒ©a. T√πy bi·∫øn t√™n ng∆∞·ªùi nh·∫≠n & chia s·∫ª d·ªÖ d√†ng." />
  <meta property="og:title" content="Thi·ªáp Trung Thu c·ªßa b·∫°n" />
  <meta property="og:description" content="M·ªü thi·ªáp ƒë·ªÉ nghe nh·∫°c v√† nh·∫≠n l·ªùi ch√∫c Trung Thu th·∫≠t √Ω nghƒ©a!" />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0b1b3a" />
  <link rel="preload" as="audio" href="trungthu.mp3" />
  <link rel="preload" as="audio" href="phao.mp3" />
  <link rel="preload" as="audio" href="trungthu1.mp3" />
  <link rel="preload" as="audio" href="trungthu2.mp3" />
  <link rel="preload" as="audio" href="trungthu3.mp3" />
  <link rel="preload" as="audio" href="trungthu4.mp3" />
  <link rel="preload" as="audio" href="phao1.mp3" />
  <style>
    :root{
      --bg1:#0b1b3a;
      --bg2:#1b335f;
      --moon:#ffe9a3;
      --lantern:#ffb84d;
      --accent:#ffd166;
      --paper:#fff7e6;
      --glass: rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:#f5f7ff; background: radial-gradient(1200px 800px at 70% -10%, #254273 0%, transparent 60%), linear-gradient(180deg, var(--bg2), var(--bg1)); overflow:hidden}

    .stars{position:fixed; inset:0; pointer-events:none}
    .stars i{position:absolute; width:2px; height:2px; background:#cfe3ff; opacity:.9; border-radius:50%; animation: twinkle 3.5s infinite ease-in-out}
    @keyframes twinkle{50%{transform:scale(1.6); opacity:.4}}

    .moon{position:absolute; top:4vh; right:6vw; width:120px; height:120px; background:radial-gradient(circle at 30% 30%, #fff7d1 20%, var(--moon) 60%, #f7d77a 100%); border-radius:50%; box-shadow:0 0 30px 10px rgba(255,233,163,.3), 0 0 100px rgba(255,233,163,.2)}

    .lantern{position:absolute; bottom:-140px; width:42px; height:60px; background:linear-gradient(180deg, #ffcf70, var(--lantern)); border-radius:10px; box-shadow:0 -8px 18px rgba(255,209,102,.35) inset, 0 8px 18px rgba(0,0,0,.25) inset, 0 0 24px rgba(255,184,77,.5); transform:translateY(0) scale(1); animation: floatUp 16s linear infinite}
    .lantern::before{content:""; position:absolute; left:50%; top:-16px; width:22px; height:16px; transform:translateX(-50%); background:linear-gradient(180deg, #fbe7b8, #ffd166); border-radius:4px 4px 0 0}
    .lantern::after{content:""; position:absolute; left:50%; bottom:-14px; width:18px; height:14px; transform:translateX(-50%); background:linear-gradient(180deg, #ffebc6, #ffb84d); border-radius:0 0 4px 4px; box-shadow:0 4px 12px rgba(255,184,77,.7)}
    @keyframes floatUp{0%{transform:translateY(0)}100%{transform:translateY(-120vh)}}

    .wrap{position:relative; z-index:2; height:100dvh; display:grid; place-items:center; padding:24px}
    .card{width:min(920px,92vw); background:linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.06)); border:1px solid rgba(255,255,255,.18); border-radius:24px; box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.2); backdrop-filter:blur(10px); overflow:hidden}
    .card-header{display:flex; align-items:center; gap:14px; padding:18px 22px; background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02)); border-bottom:1px solid rgba(255,255,255,.15)}
    .title{font-size:clamp(22px,2.6vw,32px); margin:0; font-weight:800}
    .subtitle{opacity:.85; font-size:clamp(13px,1.4vw,15px)}
    .paper{background:var(--paper); color:#3b2f1a; padding:22px; border-radius:14px; box-shadow:inset 0 2px 0 #fff, 0 10px 24px rgba(0,0,0,.15)}

    .content{display:grid; grid-template-columns:1.1fr .9fr; gap:18px; padding:22px}
    @media(max-width:860px){.content{grid-template-columns:1fr; gap:14px}}

    .wish{min-height:220px; line-height:1.6; font-size:clamp(17px,2vw,20px)}

    .actions{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    button,.ghost{border:0; padding:10px 14px; border-radius:999px; font-weight:700; cursor:pointer; background:#1e293b; color:#e9f1ff; border:1px solid rgba(255,255,255,.2); transition:.2s}
    button:hover,.ghost:hover{transform:translateY(-1px); box-shadow:0 8px 20px rgba(0,0,0,.25)}
    button.primary{background:linear-gradient(180deg,#ffd166,#ffb84d); color:#3b2f1a; border-color:#f59f0b}
    .ghost{background:#334155; color:#e9f1ff; border-color:rgba(255,255,255,.55)}
    #btnShare.ghost{background:linear-gradient(180deg,#ffd166,#ffb84d); color:#3b2f1a; border-color:#f59f0b; box-shadow:0 8px 20px rgba(255,184,77,.4)}

    .greeting{font-weight:800; font-size:clamp(18px,2.2vw,22px); margin:0 0 6px}
    .small{font-size:13px; opacity:.8}

    .editor{margin-top:12px}
    .editor label{display:block; margin:6px 0; font-weight:700; color:#3b2f1a}
    .editor textarea{width:100%; min-height:80px; padding:10px; border-radius:12px; border:1px solid rgba(0,0,0,.1); font-family:inherit; font-size:15px; color:#3b2f1a; background:#fffdf7}

    .audio-toggle{position:fixed; right:18px; bottom:18px; z-index:10; width:54px; height:54px; display:grid; place-items:center; border-radius:50%; background:var(--glass); border:1px solid rgba(255,255,255,.3); backdrop-filter:blur(8px); cursor:pointer}
    .audio-toggle svg{width:26px; height:26px; fill:#fff}
    .audio-hint{position:fixed; right:18px; bottom:80px; background:var(--glass); border:1px solid rgba(255,255,255,.25); padding:8px 12px; border-radius:10px; font-size:12px}

    .overlay{position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.75)); display:grid; place-items:center; z-index:20}
    .overlay .box{width:min(560px,92vw); text-align:center}

    #fxBack{position:fixed; inset:0; pointer-events:none; z-index:1}
    #fx{position:fixed; inset:0; pointer-events:none; z-index:3}

    footer{padding:10px 18px; text-align:center; opacity:.8; font-size:12px}
    /* --- Mobile fixes & responsive polish --- */
    body{ overflow-y:auto; }
    .wrap{ height:auto; min-height:100svh; padding:16px; }
    .card{ margin:10px auto; }
    .audio-toggle{ bottom: calc(max(18px, env(safe-area-inset-bottom))); right: calc(18px + env(safe-area-inset-right)); }
    footer{ padding-bottom: calc(10px + env(safe-area-inset-bottom)); }
    button, .ghost{ min-height:44px; touch-action:manipulation }
    @media (max-width: 600px){
      .content{ grid-template-columns:1fr; gap:12px; padding:14px }
      .paper{ padding:16px }
      .actions{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
      #btnShare{ grid-column:1/-1 }
      .title{ font-size:22px }
    }
    /* Extra mobile polish (safe areas & spacing) */
    .wrap{ padding-top: calc(16px + env(safe-area-inset-top)); padding-bottom: calc(16px + env(safe-area-inset-bottom)); }
    .card{ width:min(960px, 94vw); }
    @media (max-width:480px){
      .card{ width:95vw; }
      .paper{ padding:14px }
    }
  </style>
</head>
<body>
  <canvas id="fxBack"></canvas>
  <canvas id="fx"></canvas>
  <div class="stars"></div>
  <div class="moon"></div>
  <div class="wrap">
    <div class="card">
      <div class="card-header">
        <h1 class="title">T·∫øt Trung Thu ‚Äì TrƒÉng tr√≤n ƒëo√†n vi√™n</h1>
        <div class="subtitle">M·ªü thi·ªáp ƒë·ªÉ nghe nh·∫°c v√† nh·∫≠n nh·ªØng l·ªùi ch√∫c √Ω nghƒ©a ‚ú®</div>
      </div>
      <div class="content">
        <section class="paper">
          <p class="greeting" id="greeting"></p>
          <div id="wish" class="wish"><span id="wishText"></span></div>
          <div class="actions">
            <button class="primary" id="btnRandom">Ng·∫´u nhi√™n</button>
            <button id="btnPrev">‚óÄ</button>
            <button id="btnNext">‚ñ∂</button>
            <button id="btnCopy">Sao ch√©p</button>
            <button id="btnSong">ƒê·ªïi nh·∫°c</button>
            <a class="ghost" id="btnShare" href="#">Chia s·∫ª</a>
          </div>
          <div class="editor">
            <label for="customInput">T·ª± vi·∫øt l·ªùi ch√∫c</label>
            <textarea id="customInput" placeholder="Nh·∫≠p l·ªùi ch√∫c..."></textarea>
            <div class="actions">
              <button id="btnUse">C·∫≠p nh·∫≠t</button>
              <button id="btnAddWish">Th√™m m·ªõi</button>
              <button class="ghost" id="btnReset">Kh√¥i ph·ª•c</button>
            </div>
          </div>
          <p class="small">Nh·∫°c: <b id="trackName">trungthu</b></p>
        </section>
        <section>
          <div class="paper">
            <h3>√ù nghƒ©a ƒë√™m r·∫±m</h3>
            <p>Trung Thu l√† kho·∫£nh kh·∫Øc c·∫£ nh√† qu√¢y qu·∫ßn d∆∞·ªõi v·∫ßng trƒÉng tr√≤n, nh·∫Øc nhau g√¨n gi·ªØ y√™u th∆∞∆°ng, s·∫ª chia v√† bi·∫øt ∆°n.</p>
            <div class="actions">
              <button id="btnFire">üéá B·∫Øn ph√°o hoa</button>
              <button id="btnRemote">üì° Ph√°o t·∫ßm xa</button>
              <button id="btnLantern">üèÆ Th·∫£ ƒë√®n</button>
            </div>
          </div>
        </section>
      </div>
      <footer>Made with ‚ô• | T·∫°o l·ªùi ch√∫c t·∫°i ƒë√¢y: link</footer>
    </div>
  </div>

  <audio id="bgm" src="trungthu.mp3" preload="auto" loop></audio>
  <audio id="phao" src="phao.mp3" preload="auto"></audio>
  <audio id="phao1" src="phao1.mp3" preload="auto"></audio>
  <button class="audio-toggle" id="audioToggle"><svg id="iconPlay" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg><svg id="iconPause" viewBox="0 0 24 24" style="display:none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg></button>
  <div class="audio-hint" id="audioHint" hidden>Nh·∫•n ƒë·ªÉ b·∫≠t nh·∫°c ‚ô´</div>

  <div class="overlay" id="overlay">
    <div class="box paper">
      <h2>Ch√∫c Trung Thu vui v·∫ª! üåï</h2>
      <div class="actions"><button class="primary" id="startBtn">B·∫≠t nh·∫°c & b·∫Øt ƒë·∫ßu</button><button class="ghost" id="skipBtn">V√†o xem</button></div>
    </div>
  </div>

  <script>
// ========= Helpers =========
const $ = (s, p=document) => p.querySelector(s);
const $$ = (s, p=document) => [...p.querySelectorAll(s)];
const isMobile = matchMedia('(max-width: 480px), (pointer: coarse)').matches;

// ========= Personalize & Base link =========
const BASE = 'https://honggiabao2911.github.io/thieptrungthu/';
const params = new URLSearchParams(location.search);
const toName = decodeURIComponent((params.get('to')||'').replace(/\+/g,' ')).trim();
const fromName = decodeURIComponent((params.get('from')||'').replace(/\+/g,' ')).trim();
$('#greeting').textContent = toName ? `G·ª≠i ${toName},` : 'G·ª≠i b·∫°n,';
function buildShareUrl(){ const u = new URL(BASE); if(fromName) u.searchParams.set('from', fromName); if(toName) u.searchParams.set('to', toName); return u.toString(); }

// ========= Wishes =========
const defaultWishes = [
  'ƒê√™m r·∫±m Trung Thu kh√¥ng ch·ªâ tr√≤n v√† s√°ng, m√† c√≤n nh·∫Øc ta s·ªëng tr·ªçn v·∫πn: tr·ªçn v·ªõi gia ƒë√¨nh, tr·ªçn v·ªõi ∆∞·ªõc m∆°, v√† tr·ªçn v·ªõi ch√≠nh m√¨nh. Ch√∫c b·∫°n m·ªôt m√πa trƒÉng b√¨nh an, n∆°i l√≤ng nh·∫π nh∆∞ m√¢y v√† n·ª• c∆∞·ªùi n·ªü nh∆∞ hoa.',
  '√Ånh trƒÉng t·ªëi nay gi·ªëng nh∆∞ t·∫•m g∆∞∆°ng hi·ªÅn l√†nh soi v√†o tr√°i tim: ƒëi·ªÅu g√¨ t·ªët ƒë·∫πp h√£y gi·ªØ, ƒëi·ªÅu g√¨ n·∫∑ng l√≤ng h√£y ƒë·∫∑t xu·ªëng. Ch√∫c b·∫°n ƒë·ªß tƒ©nh l·∫∑ng ƒë·ªÉ l·∫Øng nghe m√¨nh v√† ƒë·ªß can ƒë·∫£m ƒë·ªÉ b∆∞·ªõc ti·∫øp.',
  'Ch√∫c b·∫°n v√† nh·ªØng ng∆∞·ªùi th√¢n th∆∞∆°ng c√≥ m·ªôt ƒë√™m r·∫±m ·∫•m √°p: c√≥ c√¢u chuy·ªán ƒë·ªÉ k·ªÉ, c√≥ ti·∫øng c∆∞·ªùi ƒë·ªÉ nh·ªõ, c√≥ c√°i n·∫Øm tay ƒë·ªÉ y√™n l√≤ng, v√† c√≥ ∆∞·ªõc nguy·ªán ƒë·ªÉ c√πng nhau ƒëi t·ªõi.',
  'Trung Thu l√† m√πa ƒëo√†n vi√™n, nh∆∞ng n·∫øu b·∫°n ·ªü xa, mong √°nh trƒÉng s·∫Ω l√†m chi·∫øc c·∫ßu n·ªëi nh·ªØng y√™u th∆∞∆°ng. Ch√∫c kho·∫£ng c√°ch ch·ªâ l√†m nh·ªõ th∆∞∆°ng th√™m ng·ªçt, v√† ng√†y g·∫∑p l·∫°i s·∫Ω th·∫≠t g·∫ßn.',
  'M·ªói chi·∫øc b√°nh n∆∞·ªõng d·∫ªo th∆°m l√† l·ªùi nh·∫Øc v·ªÅ s·ª± ƒë·ªß ƒë·∫ßy. Ch√∫c b·∫°n ƒë·ªß s·ª©c kh·ªèe ƒë·ªÉ gieo, ƒë·ªß ki√™n nh·∫´n ƒë·ªÉ ch·ªù, ƒë·ªß ni·ªÅm vui ƒë·ªÉ g·∫∑t, v√† ƒë·ªß bi·∫øt ∆°n ƒë·ªÉ gi·ªØ nh·ªØng g√¨ qu√Ω gi√°.',
  'ƒê√™m trƒÉng tr√≤n d·∫°y ta v·ªÅ s·ª± tr·ªçn v·∫πn, nh∆∞ng c≈©ng nh·∫Øc ta ch·∫•p nh·∫≠n nh·ªØng m·∫£nh gh√©p c√≤n dang d·ªü. Ch√∫c b·∫°n b√¨nh th·∫£n v·ªõi nh·ªØng ƒëi·ªÅu ch∆∞a k·ªãp ho√†n h·∫£o, v√† d·ªãu d√†ng v·ªõi ch√≠nh m√¨nh.',
  'Ch√∫c b·∫°n c√≥ m·ªôt m√°i nh√† ƒë·ªÉ tr·ªü v·ªÅ, m·ªôt chi·∫øc b√†n ƒë·ªÉ qu√¢y qu·∫ßn, v√† nh·ªØng √°nh m·∫Øt ƒë·ªÉ trao nhau s·ª± an t√¢m. B√¨nh y√™n ƒë√¥i khi ch·ªâ c·∫ßn gi·∫£n d·ªã ƒë·∫øn th·∫ø.',
  'N·∫øu nƒÉm qua nhi·ªÅu b√£o gi√¥ng, mong trƒÉng r·∫±m t·ªëi nay l√† ch·ªó b·∫°n ng·ªìi xu·ªëng th·ªü s√¢u. Ch√∫c n·ªói bu·ªìn kh√©p l·∫°i nh∆∞ c√°nh c·ª≠a, v√† c√°nh c·ª≠a m·ªõi m·ªü ra c√≥ n·∫Øng ·∫•m ch·ªù.',
  'Trung Thu cho ta c√°i c·ªõ ƒë·ªÉ n√≥i l·ªùi th∆∞∆°ng. Ch√∫c b·∫°n n√≥i ƒë∆∞·ª£c ƒëi·ªÅu c·∫ßn n√≥i, √¥m ƒë∆∞·ª£c ng∆∞·ªùi c·∫ßn √¥m, v√† k·ªãp tr√¢n tr·ªçng ƒëi·ªÅu ƒëang c√≥ tr∆∞·ªõc khi n√≥ tr·ªü th√†nh ƒëi·ªÅu ƒë√£ qua.',
  'Ch√∫c c√¥ng vi·ªác c·ªßa b·∫°n hanh th√¥ng nh∆∞ con ƒë∆∞·ªùng d∆∞·ªõi trƒÉng‚Äîv·ª´a s√°ng, v·ª´a r√µ. M·ªói b∆∞·ªõc ƒëi c√≥ m·ª•c ƒë√≠ch, m·ªói ng√†y m·ªõi c√≥ hi v·ªçng.',
  'H·ªçc h√†nh l√† h√†nh tr√¨nh d√†i. Ch√∫c b·∫°n h·ªçc ƒë∆∞·ª£c ƒëi·ªÅu kh√≥ m·ªôt c√°ch nh·∫π nh√†ng, b·ªÅn b·ªâ nh∆∞ trƒÉng‚Äîkh√¥ng v·ªôi v√†ng nh∆∞ng lu√¥n tr√≤n ƒë√∫ng h·∫πn.',
  'Mong nh√† b·∫°n c√≥ ti·∫øng n√≥i c∆∞·ªùi, c√≥ h·∫°nh ph√∫c ƒë·ªß ƒë·∫ßy v√† c√≥ nh·ªØng b·∫•t ƒë·ªìng ƒë·ªß nh·ªè ƒë·ªÉ h·ªçc c√°ch y√™u nhau h∆°n.',
  'Ch√∫c b·∫°n ƒë·ªß nghi√™m t√∫c v·ªõi ∆∞·ªõc m∆° ƒë·ªÉ kh√¥ng b·ªè cu·ªôc, v√† ƒë·ªß h√†i h∆∞·ªõc v·ªõi cu·ªôc ƒë·ªùi ƒë·ªÉ kh√¥ng c·ª©ng nh·∫Øc. V·ª´a v·ªØng v√†ng, v·ª´a nh·∫π nh√†ng.',
  'ƒê√™m nay, th·ª≠ tha th·ª© cho ƒëi·ªÅu kh√≥ tha v√† bi·∫øt ∆°n v√¨ ƒëi·ªÅu d·ªÖ th∆∞∆°ng. Ch√∫c tr√°i tim b·∫°n c√≥ th√™m m·ªôt ngƒÉn nh·ªè cho s·ª± c·∫£m th√¥ng.',
  'Ch√∫c nh·ªØng kh·ªüi ƒë·∫ßu m·ªõi c·ªßa b·∫°n ƒë∆∞·ª£c n√¢ng ƒë·ª° b·ªüi l√≤ng t·ªët c·ªßa ng∆∞·ªùi kh√°c‚Äîv√† ch√≠nh b·∫°n c≈©ng tr·ªü th√†nh s·ª± n√¢ng ƒë·ª° cho ai ƒë√≥.',
  'N·∫øu c√≥ ƒëi·ªÅu g√¨ b·∫°n mong c·∫ßu, mong n√≥ ƒë·∫øn khi b·∫°n ƒë√£ s·∫µn s√†ng. C√≤n n·∫øu ch∆∞a ƒë·∫øn, mong b·∫°n v·∫´n b√¨nh y√™n v√† b·ªÅn b·ªâ ti·∫øp t·ª•c gieo.',
  'Trung Thu l√† d·ªãp cho tr·∫ª th∆°, nh∆∞ng ng∆∞·ªùi l·ªõn c≈©ng c·∫ßn m·ªôt ƒë√™m ƒë·ªÉ tin v√†o ƒëi·ªÅu l√†nh. Ch√∫c b·∫°n gi·ªØ l·∫°i m·ªôt ph·∫ßn ‚Äútr·∫ª th∆°‚Äù trong tim ƒë·ªÉ cu·ªôc s·ªëng lu√¥n c√≥ ch·ªó cho k·ª≥ di·ªáu.',
  'Ch√∫c b·∫°n ƒë·ªß th·ªùi gian cho c√¥ng vi·ªác, ƒë·ªß d·ªãu d√†ng cho t√¨nh th√¢n, v√† ƒë·ªß ri√™ng t∆∞ cho ch√≠nh m√¨nh. M·ªçi ƒëi·ªÅu ƒë·ªÅu c·∫ßn kh√¥ng gian ƒë·ªÉ l·ªõn l√™n.',
  'Mong b·∫°n nh·∫≠n ƒë∆∞·ª£c nh·ªØng l·ªùi ch√∫c ch√¢n th√†nh, v√† c≈©ng g·ª≠i ƒëi ƒë∆∞·ª£c m·ªôt l·ªùi ch√∫c l√†m ai ƒë√≥ ·∫•m l√≤ng. S·ª± t·ª≠ t·∫ø lan nhanh h∆°n √°nh ph√°o hoa.',
  'N·∫øu b·∫°n ƒëang m·ªèi m·ªát, ch√∫c ƒë√™m r·∫±m n√†y l√† tr·∫°m ngh·ªâ: u·ªëng ng·ª•m tr√† ·∫•m, n√≥i v√†i c√¢u n√™n n√≥i, v√† ƒë·ªÉ tr√°i tim ƒë∆∞·ª£c y√™n tƒ©nh m·ªôt l√°t.',
  'Ch√∫c b·∫°n c√≥ ng∆∞·ªùi ƒë·ªÉ tr√≤ chuy·ªán, c√≥ vi·ªác ƒë·ªÉ say m√™, c√≥ n∆°i ƒë·ªÉ tr·ªü v·ªÅ. Ba ƒëi·ªÅu ƒë√≥ gh√©p l·∫°i ƒë√£ l√† h·∫°nh ph√∫c gi·∫£n ƒë∆°n.',
  'Mong gi·∫•c ng·ªß ƒë√™m nay th·∫≠t s√¢u, mang theo nh·ªØng ∆∞·ªõc m∆° hi·ªÅn h·∫≠u. S√°ng mai th·ª©c d·∫≠y, b·∫°n th·∫•y m√¨nh th·∫£nh th∆°i v√† tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng.',
  'Ch√∫c b·∫°n h·ªçc c√°ch bu√¥ng b·ªè th·ª© l√†m m√¨nh n·∫∑ng n·ªÅ‚Äîƒë·ªÉ tay c√≤n r·∫£nh m√† ƒë√≥n nh·∫≠n ƒëi·ªÅu ƒë√°ng gi√° ƒëang t·ªõi.',
  'Trung Thu g·ª≠i t·∫∑ng ta chi·∫øc la b√†n t√™n l√† ‚Äúbi·∫øt ∆°n‚Äù. Ch√∫c b·∫°n lu√¥n t√¨m ƒë∆∞·ª£c h∆∞·ªõng ƒë√∫ng trong nh·ªØng ng√†y nhi·ªÅu ng√£ r·∫Ω.',
  'Ch√∫c m·ªëi quan h·ªá b·∫°n tr√¢n tr·ªçng ƒë∆∞·ª£c nu√¥i d∆∞·ª°ng b·∫±ng l·∫Øng nghe, t√¥n tr·ªçng v√† nh·ªØng ƒëi·ªÅu nh·ªè b√© l√†m nhau m·ªâm c∆∞·ªùi m·ªói ng√†y.',
  'N·∫øu nƒÉm nay b·∫°n c√≥ m·∫•t m√°t, xin g·ª≠i m·ªôt c√°i √¥m t·ª´ xa. Mong k√Ω ·ª©c ƒë·∫πp s·∫Ω d·ªãu ƒëi n·ªói ƒëau v√† bi·∫øn th√†nh s·ª©c m·∫°nh d·ªãu d√†ng trong b·∫°n.',
  'Ch√∫c b·∫°n ƒë·ªß duy√™n g·∫∑p ƒë√∫ng ng∆∞·ªùi, ƒë√∫ng vi·ªác, ƒë√∫ng th·ªùi ƒëi·ªÉm. C√≤n tr∆∞·ªõc ƒë√≥, mong b·∫°n v·∫´n ƒë·ªß vui v·ªõi h√†nh tr√¨nh m·ªôt m√¨nh.',
  'Mong nh·ªØng n·ªó l·ª±c th·∫ßm l·∫∑ng c·ªßa b·∫°n ƒë∆∞·ª£c ghi nh·∫≠n, c√≤n nh·ªØng ƒëi·ªÅu ch∆∞a nh∆∞ √Ω s·ªõm ho√° c∆° h·ªôi ƒë·ªÉ tr∆∞·ªüng th√†nh.',
  'Ch√∫c b·∫°n ƒëi nh·∫π trong th·∫ø gi·ªõi ·ªìn √†o, gi·ªØ l√≤ng s√°ng trong khi b∆∞·ªõc qua nh·ªØng ng√£ r·∫Ω kh√≥ ƒëo√°n.',
  'ƒê√™m trƒÉng tr√≤n‚Äîch√∫c tr√°i tim b·∫°n c≈©ng tr√≤n: tr√≤n s·ª± t·ª≠ t·∫ø, tr√≤n l·ªùi h·ª©a v·ªõi b·∫£n th√¢n, v√† tr√≤n hi v·ªçng v·ªÅ ng√†y mai.',
  'Ch√∫c c√°c em nh·ªè c√≥ m√πa l√¢n r·ªôn r√£, ƒë√®n l·ªìng lung linh; ch√∫c ng∆∞·ªùi l·ªõn c√≥ ph√∫t gi√¢y tr·ªü v·ªÅ tu·ªïi th∆° ƒë·ªÉ th·∫•y m√¨nh d·ªãu l·∫°i.',
  'Mong m·ªçi ƒëi·ªÅu b·∫°n g·ª≠i v√†o v≈© tr·ª• t·ªëi nay s·∫Ω quay v·ªÅ theo c√°ch t·ªët l√†nh nh·∫•t, ƒë√∫ng l√∫c nh·∫•t.',
  'Ch√∫c b·∫°n ƒë·ªß t√†i ƒë·ªÉ l√†m, ƒë·ªß t√¢m ƒë·ªÉ s·ªëng, v√† ƒë·ªß t·∫ßm ƒë·ªÉ y√™u th∆∞∆°ng r·ªông l∆∞·ª£ng.',
  'N·∫øu tr√°i tim b·∫°n ƒëang h·∫πp l·∫°i v√¨ lo toan, mong trƒÉng r·∫±m m·ªü ra m·ªôt khung c·ª≠a m·ªõi, ƒë·ªÉ gi√≥ m√°t v√† hi v·ªçng b∆∞·ªõc v√†o.',
  'Ch√∫c b·∫°n lu√¥n c√≥ th·ª© ƒë·ªÉ mong ch·ªù, ng∆∞·ªùi ƒë·ªÉ tin c·∫≠y, v√† l√Ω do ƒë·ªÉ m·ªâm c∆∞·ªùi m·ªói cu·ªëi ng√†y.'
];

let wishes; try{ const saved = JSON.parse(localStorage.getItem('wishesUser')||'null'); wishes = Array.isArray(saved) && saved.length ? saved : [...defaultWishes]; }catch{ wishes=[...defaultWishes]; }
let idx = 0; function render(){ $('#wishText').textContent = wishes[idx]; }
render();

// ========= Emoji decoration for share/copy =========
function decorate(text){
  const pre = ['üåï','üèÆ','üéë','‚ú®','ü•Æ'];
  const suf = ['‚ú®','üåï','üèÆ','‚≠êÔ∏è'];
  const p = pre[Math.floor(Math.random()*pre.length)];
  const s = suf[Math.floor(Math.random()*suf.length)];
  return p+' '+text+' '+s;
}

// ========= Buttons =========
$('#btnPrev').onclick = ()=>{ idx=(idx-1+wishes.length)%wishes.length; render(); };
$('#btnNext').onclick = ()=>{ idx=(idx+1)%wishes.length; render(); };
$('#btnRandom').onclick = ()=>{ idx=Math.floor(Math.random()*wishes.length); render(); };

// ========= Copy (one link only) =========
$('#btnCopy').onclick = async ()=>{
  const head = toName?`G·ª≠i ${toName}, `:'';
  const text = `${head}${decorate(wishes[idx])}
T·∫°o l·ªùi ch√∫c t·∫°i ƒë√¢y: ${BASE}`;
  await navigator.clipboard.writeText(text); toast('ƒê√£ sao ch√©p l·ªùi ch√∫c!'); sparkle();
};

// ========= Share as IMAGE (fallback to download) =========
$('#btnShare').onclick = async (e)=>{
  e.preventDefault();
  const {blob} = await createCardImage({
    to: toName || 'b·∫°n',
    from: fromName || 'M·ªôt ng∆∞·ªùi b·∫°n',
    text: decorate(wishes[idx])
  });
  const file = new File([blob], 'thiep-trung-thu.png', {type:'image/png'});
  const caption = `T·∫°o l·ªùi ch√∫c t·∫°i ƒë√¢y: ${BASE}`; // only one link
  try{
    if(navigator.canShare && navigator.canShare({ files:[file] })){
      await navigator.share({ files:[file], title: 'Thi·ªáp Trung Thu', text: caption });
      toast('ƒê√£ m·ªü chia s·∫ª b·∫±ng ·∫£nh');
    } else {
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='thiep-trung-thu.png'; document.body.appendChild(a); a.click(); a.remove(); toast('ƒê√£ t·∫°o ·∫£nh thi·ªáp (ƒë√£ t·∫£i xu·ªëng)');
      await navigator.clipboard.writeText(caption);
    }
  }catch(err){ toast('Kh√¥ng th·ªÉ chia s·∫ª ‚Äî ƒë√£ t·∫°o ·∫£nh ƒë·ªÉ t·∫£i'); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='thiep-trung-thu.png'; document.body.appendChild(a); a.click(); a.remove(); }
};

// ========= Custom editor =========
const input=$('#customInput'); const btnUse=$('#btnUse'); const btnAdd=$('#btnAddWish'); const btnReset=$('#btnReset');
function persist(){ try{ localStorage.setItem('wishesUser', JSON.stringify(wishes)); }catch{} }
btnUse && (btnUse.onclick=()=>{ const v=(input.value||'').trim(); if(!v) return toast('B·∫°n ch∆∞a nh·∫≠p n·ªôi dung'); wishes[idx]=v; persist(); render(); toast('ƒê√£ c·∫≠p nh·∫≠t l·ªùi ch√∫c!'); });
btnAdd && (btnAdd.onclick=()=>{ const v=(input.value||'').trim(); if(!v) return toast('B·∫°n ch∆∞a nh·∫≠p n·ªôi dung'); wishes.push(v); idx=wishes.length-1; persist(); render(); toast('ƒê√£ th√™m l·ªùi ch√∫c!'); });
btnReset && (btnReset.onclick=()=>{ wishes=[...defaultWishes]; idx=0; persist(); render(); toast('ƒê√£ kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh'); });

// ========= Audio & playlist =========
const audio = $('#bgm'); const toggleBtn = $('#audioToggle'); const iconPlay=$('#iconPlay'); const iconPause=$('#iconPause'); let isPlaying=false;
function updateAudioUI(){ iconPlay.style.display = isPlaying?'none':'block'; iconPause.style.display = isPlaying?'block':'none'; }
async function playAudio(){ try{ await audio.play(); isPlaying=true; updateAudioUI(); }catch{ $('#audioHint').hidden=false; } }
function pauseAudio(){ audio.pause(); isPlaying=false; updateAudioUI(); }
toggleBtn.onclick = ()=>{ isPlaying ? pauseAudio() : playAudio(); };
const tracks=['trungthu.mp3','trungthu1.mp3','trungthu2.mp3','trungthu3.mp3','trungthu4.mp3']; let trackIndex=0;
function updateTrack(){ $('#trackName').textContent = tracks[trackIndex].replace('.mp3',''); }
function setTrack(i){ trackIndex=(i+tracks.length)%tracks.length; audio.src=tracks[trackIndex]; if(isPlaying){ audio.currentTime=0; audio.play().catch(()=>{}); } updateTrack(); }
$('#btnSong').onclick = ()=>{ setTrack(trackIndex+1); toast('ƒê·ªïi nh·∫°c: '+tracks[trackIndex].replace('.mp3','')); };
audio.addEventListener('ended', ()=> setTrack(trackIndex+1)); updateTrack();
$('#startBtn').onclick = async ()=>{ await playAudio(); $('#overlay').style.display='none'; sparkle(); };
$('#skipBtn').onclick = ()=>{ $('#overlay').style.display='none'; };

// ========= Canvases (effects) =========
const fx = $('#fx'); const ctx = fx.getContext('2d'); const fxBack = $('#fxBack'); const ctxB = fxBack.getContext('2d');
function resize(){ fx.width = innerWidth*devicePixelRatio; fx.height = innerHeight*devicePixelRatio; fxBack.width = innerWidth*devicePixelRatio; fxBack.height = innerHeight*devicePixelRatio; }
addEventListener('resize', resize); resize();

// Foreground particles
const particles=[]; function spawn(x,y,color,count=140){ count=Math.floor(count*(isMobile?0.6:1)); for(let i=0;i<count;i++){ const a=Math.random()*Math.PI*2; const s=Math.random()*4+1.6; particles.push({x:x*devicePixelRatio,y:y*devicePixelRatio,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:120+Math.random()*160,color}); } }
function sparkle(){ const col='hsl('+ (Math.random()*360) +',100%,70%)'; spawn(innerWidth*0.5, innerHeight*0.35, col, isMobile?50:80); }
function loop(){ ctx.globalCompositeOperation='destination-out'; ctx.fillStyle='rgba(0,0,0,0.12)'; ctx.fillRect(0,0,fx.width,fx.height); ctx.globalCompositeOperation='lighter'; for(const p of particles){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.01; p.life-=1; ctx.beginPath(); ctx.arc(p.x,p.y, 2*devicePixelRatio, 0, Math.PI*2); ctx.fillStyle=p.color; ctx.fill(); } for(let i=particles.length-1;i>=0;i--){ if(particles[i].life<=0) particles.splice(i,1); } requestAnimationFrame(loop); } loop();
$('#btnFire').onclick = ()=>{ for(let i=0;i<3;i++) setTimeout(()=>{ const col='hsl('+ (Math.random()*360) +',100%,70%)'; spawn(innerWidth*Math.random(), innerHeight*(.3+.4*Math.random()), col, 150); playSfxNear(); }, i*180); };

// Background shapes
const farParticles=[]; function addFarPoint(cx,cy,px,py,color){ const j=0.6,s=devicePixelRatio; const vx=px*0.02+(Math.random()-0.5)*j; const vy=py*0.02+(Math.random()-0.5)*j; farParticles.push({x:(cx+px)*s,y:(cy+py)*s,vx,vy,life:240+Math.random()*140,color}); }
function spawnShapeBack(shape){ const cx=innerWidth*(0.2+0.6*Math.random()); const cy=innerHeight*(0.18+0.22*Math.random()); const hue=Math.floor(Math.random()*360); const color='hsl('+hue+',100%,70%)'; const r=Math.min(innerWidth,innerHeight)*0.08; const N=140; if(shape==='ring'){ for(let i=0;i<N;i++){ const t=i/N*2*Math.PI; addFarPoint(cx,cy,Math.cos(t)*r,Math.sin(t)*r,color); } } else if(shape==='star'){ const spikes=5,r1=r,r2=r*0.45,pts=spikes*2; for(let i=0;i<pts;i++){ const t=i/pts*2*Math.PI; const rr=(i%2===0)?r1:r2; addFarPoint(cx,cy,Math.cos(t)*rr,Math.sin(t)*rr,color); } } else if(shape==='heart'){ for(let i=0;i<N;i++){ const t=i/N*2*Math.PI; const x=16*Math.sin(t)**3; const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t); const s=r/18; addFarPoint(cx,cy,x*s,-y*s,color); } } else if(shape==='smiley'){ for(let i=0;i<N;i++){ const t=i/N*2*Math.PI; addFarPoint(cx,cy,Math.cos(t)*r,Math.sin(t)*r,color); } const er=r*0.12, ex=r*0.35, ey=-r*0.2; for(let i=0;i<40;i++){ const t=i/40*2*Math.PI; addFarPoint(cx+ex,cy+ey,Math.cos(t)*er,Math.sin(t)*er,color); addFarPoint(cx-ex,cy+ey,Math.cos(t)*er,Math.sin(t)*er,color); } for(let i=0;i<70;i++){ const t=(-Math.PI*0.1)+(i/70)*Math.PI*1.2; const rr=r*0.55; addFarPoint(cx,cy+r*0.15,Math.cos(t)*rr,Math.sin(t)*rr,color); } } else if(shape==='spiral'){ const turns=3.2,steps=240,sr=r*0.1,er=r; for(let i=0;i<steps;i++){ const t=i/steps*turns*2*Math.PI; const rr=sr+(er-sr)*(i/steps); addFarPoint(cx,cy,Math.cos(t)*rr,Math.sin(t)*rr,color); } } }
function loopBack(){ ctxB.globalCompositeOperation='destination-out'; ctxB.fillStyle='rgba(0,0,0,0.10)'; ctxB.fillRect(0,0,fxBack.width,fxBack.height); ctxB.globalCompositeOperation='lighter'; for(const p of farParticles){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.004; p.life-=1; ctxB.beginPath(); ctxB.arc(p.x,p.y, 1.8*devicePixelRatio, 0, Math.PI*2); ctxB.fillStyle=p.color; ctxB.fill(); } for(let i=farParticles.length-1;i>=0;i--){ if(farParticles[i].life<=0) farParticles.splice(i,1); } requestAnimationFrame(loopBack); } loopBack();
const shapes=['ring','star','heart','smiley','spiral']; $('#btnRemote').onclick = ()=>{ const bursts=2+Math.floor(Math.random()*2); for(let i=0;i<bursts;i++) setTimeout(()=>{ spawnShapeBack(shapes[Math.floor(Math.random()*shapes.length)]); playSfxFar(); }, i*260); };

// Stars & lanterns
const sky = $('.stars'); function makeStar(n=120){ for(let i=0;i<n;i++){ const s=document.createElement('i'); s.style.left=(Math.random()*100)+'%'; s.style.top=(Math.random()*100)+'%'; const d=Math.random()*3+1; s.style.opacity=0.6+Math.random()*0.4; s.style.animationDuration=(2.5+Math.random()*2)+'s'; s.style.transform='scale('+(d/2)+')'; sky.appendChild(s); } }
function makeLanterns(n=10){ for(let i=0;i<n;i++){ const l=document.createElement('div'); l.className='lantern'; l.style.left=(Math.random()*100)+'%'; l.style.animationDuration=(12+Math.random()*8)+'s'; l.style.opacity=0.7+Math.random()*0.3; l.style.filter='hue-rotate('+(Math.floor(Math.random()*60)-30)+'deg)'; document.body.appendChild(l); } }
makeStar(isMobile?70:120); makeLanterns(isMobile?8:12); $('#btnLantern').onclick = ()=> makeLanterns(5);

// SFX
function clonePlay(el, vol=0.7, ttl=6000){ try{ const c=el.cloneNode(); c.volume=vol; c.play(); setTimeout(()=>c.remove(), ttl); }catch{} }
const sfxNear=$('#phao'); const sfxFar=$('#phao1'); function playSfxNear(){ clonePlay(sfxNear,0.7,5000); } function playSfxFar(){ clonePlay(sfxFar,0.55,6000); }

// ========= Card image generator =========
function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
function wrapText(ctx, text, x, y, maxWidth, lineHeight){ const words=text.split(' '); let line=''; const lines=[]; for(let n=0;n<words.length;n++){ const testLine = line + words[n] + ' '; const metrics = ctx.measureText(testLine); if(metrics.width > maxWidth && n>0){ lines.push(line.trim()); line = words[n] + ' '; } else { line = testLine; } } lines.push(line.trim()); for(let i=0;i<lines.length;i++){ ctx.fillText(lines[i], x, y + i*lineHeight); } return y + (lines.length-1)*lineHeight; }
async function createCardImage({to, from, text}){
  const W=1080, H=1350; const canvas=document.createElement('canvas'); canvas.width=W; canvas.height=H; const c=canvas.getContext('2d');
  // Background gradient
  const g=c.createLinearGradient(0,0,0,H); g.addColorStop(0,'#0b1b3a'); g.addColorStop(1,'#1b335f'); c.fillStyle=g; c.fillRect(0,0,W,H);
  // Moon
  c.save(); c.shadowColor='rgba(255,233,163,.4)'; c.shadowBlur=60; c.fillStyle='#ffe9a3'; c.beginPath(); c.arc(W*0.82,H*0.18,80,0,Math.PI*2); c.fill(); c.restore();
  // Lanterns (soft glow)
  function lantern(x,y,s,color){ c.save(); c.translate(x,y); c.scale(s,s); c.fillStyle=color; c.shadowColor=color; c.shadowBlur=40; roundRect(c,-30,-45,60,90,16); c.fill(); c.restore(); }
  lantern(160,160,1.0,'#ffcf70'); lantern(260,280,0.8,'#ffd166'); lantern(W-220,240,0.9,'#ffc35a');
  // Card container
  const M=80; const cardW=W-M*2, cardH=H-380; const cardX=M, cardY=260;
  c.save(); c.shadowColor='rgba(0,0,0,.25)'; c.shadowBlur=24; c.fillStyle='#fff7e6'; roundRect(c, cardX, cardY, cardW, cardH, 28); c.fill(); c.restore();
  c.lineWidth=2; c.strokeStyle='#ffd166'; roundRect(c, cardX, cardY, cardW, cardH, 28); c.stroke();
  // Text
  c.fillStyle='#3b2f1a'; c.font='700 40px sans-serif'; c.fillText('Thi·ªáp Trung Thu', cardX+28, cardY+60);
  c.font='700 36px sans-serif'; c.fillText('G·ª≠i ' + (to||'b·∫°n') + ',', cardX+28, cardY+120);
  c.font='400 34px sans-serif';
  const maxW = cardW-56; let y = cardY+180; y = wrapText(c, text, cardX+28, y, maxW, 50) + 20;
  // From line
  c.font='500 30px sans-serif'; c.fillText('T·ª´: ' + (from||'M·ªôt ng∆∞·ªùi b·∫°n'), cardX+28, y+50);
  // Footer link
  c.globalAlpha=0.8; c.font='400 26px sans-serif'; c.fillText('T·∫°o l·ªùi ch√∫c t·∫°i ƒë√¢y: ' + BASE, cardX+28, cardY+cardH-32);
  c.globalAlpha=1;
  return new Promise((resolve)=> canvas.toBlob((blob)=> resolve({blob}), 'image/png'));
}

// ===== Toast =====
function toast(msg){ const t=document.createElement('div'); t.textContent=msg; Object.assign(t.style,{ position:'fixed', left:'50%', bottom:'30px', transform:'translateX(-50%)', background:'rgba(0,0,0,.7)', color:'#fff', padding:'10px 14px', borderRadius:'999px', zIndex:99, fontWeight:700 }); document.body.appendChild(t); setTimeout(()=>{ t.remove(); }, 1500); }
</script>
</body>
</html>
